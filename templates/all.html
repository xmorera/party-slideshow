<!-- filepath: c:\github\xmorera\party-slideshow\templates\all.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>All Photos - SFC 30</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="color-scheme" content="light">
<style>
:root{--gap:14px;--thumb-radius:12px;--thumb-border:#e3e3e3;--bg:#ffffff;--accent:#111;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:"Segoe UI",system-ui,sans-serif;background:var(--bg);color:#111;min-height:100vh;-webkit-font-smoothing:antialiased;}
header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-bottom:1px solid #e5e5e5;display:flex;align-items:center;gap:18px;padding:14px 20px;flex-wrap:wrap;}
h1{font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:10px;margin:0;letter-spacing:.5px;}
.badge{display:inline-block;background:#111;color:#fff;font-size:.65rem;padding:4px 9px;border-radius:16px;letter-spacing:.5px;font-weight:500;}
nav{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;}
nav a{text-decoration:none;background:#111;color:#fff;padding:8px 16px;border-radius:22px;font-size:.72rem;font-weight:500;letter-spacing:.5px;transition:.25s;}
nav a:hover{background:#333;}
main{padding:20px 18px 60px;max-width:1600px;margin:0 auto;}
.grid{display:grid;gap:var(--gap);grid-template-columns:repeat(auto-fill,minmax(170px,1fr));}
@media (min-width:800px){.grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));}}
@media (min-width:1200px){.grid{grid-template-columns:repeat(auto-fill,minmax(230px,1fr));}}
.thumb{position:relative;aspect-ratio:1/1;border:1px solid var(--thumb-border);border-radius:var(--thumb-radius);overflow:hidden;background:#f5f5f5;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:box-shadow .25s,transform .25s;isolation:isolate;}
.thumb:focus-visible{outline:3px solid #2563eb;outline-offset:2px;}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .6s ease;user-select:none;}
.thumb:hover img{transform:scale(1.07);}
.thumb:hover{box-shadow:0 6px 20px -6px rgba(0,0,0,.25);transform:translateY(-3px);}
.thumb .idx{position:absolute;top:6px;left:6px;background:rgba(0,0,0,.55);color:#fff;font-size:10px;padding:3px 7px;border-radius:12px;letter-spacing:.4px;font-weight:500;pointer-events:none;}
.skel{width:100%;height:100%;background:linear-gradient(100deg,#eee 20%,#f5f5f5 40%,#eee 60%);background-size:200% 100%;animation:shimmer 1.2s infinite;position:absolute;inset:0;}
@keyframes shimmer{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
.empty{padding:70px 10px;text-align:center;font-size:1rem;color:#555;}
.error{color:#c0392b;}
footer{text-align:center;font-size:.65rem;padding:40px 0 60px;color:#666;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.88);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;z-index:100;backdrop-filter:blur(8px);padding:30px 20px;}
.overlay.open{opacity:1;pointer-events:auto;}
.viewer{max-width:95vw;max-height:95vh;width:100%;display:flex;flex-direction:column;align-items:center;gap:14px;position:relative;}
.viewer img{max-width:100%;max-height:80vh;object-fit:contain;border-radius:14px;background:#111;box-shadow:0 10px 40px -10px rgba(0,0,0,.6);}
.close-btn{position:absolute;top:-12px;right:-12px;width:50px;height:50px;border-radius:50%;border:0;background:rgba(0,0,0,.55);color:#fff;font-size:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.25s;}
.close-btn:hover{background:rgba(0,0,0,.75);}
.viewer-meta{font-size:.7rem;color:#e0e0e0;letter-spacing:.4px;text-align:center;max-width:90%;word-break:break-all;}
.nav-arrows{position:absolute;inset:0;display:flex;align-items:center;justify-content:space-between;pointer-events:none;}
.nav-arrows button{pointer-events:auto;background:rgba(0,0,0,.5);color:#fff;border:0;width:58px;height:58px;border-radius:50%;font-size:26px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.25s;}
.nav-arrows button:hover{background:rgba(0,0,0,.75);}
.nav-arrows button:disabled{opacity:.25;cursor:not-allowed;}
</style>
</head>
<body>
<header>
  <h1>All Photos <span id="count" class="badge">0</span></h1>
  <nav>
    <a href="/">Slideshow</a>
    <a href="/upload">Upload</a>
  </nav>
</header>
<main>
  <div id="status" class="empty" style="display:none;"></div>
  <div id="grid" class="grid" aria-live="polite" aria-busy="true"></div>
</main>
<footer>&copy; SFC 30</footer>

<div id="overlay" class="overlay" aria-modal="true" role="dialog" aria-label="Image viewer">
  <div class="viewer">
    <div class="nav-arrows">
      <button id="prevBtn" aria-label="Previous image">&larr;</button>
      <button id="nextBtn" aria-label="Next image">&rarr;</button>
    </div>
    <img id="viewImg" alt="Selected image">
    <div class="viewer-meta" id="meta"></div>
    <button class="close-btn" id="closeBtn" aria-label="Close viewer">&times;</button>
  </div>
</div>

<script>
(async function init(){
  const grid=document.getElementById('grid');
  const countEl=document.getElementById('count');
  const status=document.getElementById('status');

  function setStatus(msg, cls=''){
    status.textContent=msg;
    status.className='empty '+cls;
    status.style.display='block';
  }

  setStatus('Loading photos...');
  try{
    const res=await fetch('/api/images',{cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data=await res.json();
    if(data.status!=='success') throw new Error(data.error||'API error');
    const urls=data.images||[];
    status.style.display='none';
    if(!urls.length){ setStatus('No photos yet.'); return; }
    countEl.textContent=urls.length;
    const frag=document.createDocumentFragment();
    urls.forEach((url,idx)=>{
      const btn=document.createElement('button');
      btn.type='button';
      btn.className='thumb';
      btn.setAttribute('aria-label','Open image '+(idx+1));
      const skel=document.createElement('div');skel.className='skel';btn.appendChild(skel);
      const img=document.createElement('img');
      img.loading='lazy';img.decoding='async';img.src=url;img.alt='Photo '+(idx+1);
      img.onload=()=>skel.remove();
      img.onerror=()=>{skel.remove();btn.style.background='#f87171';btn.textContent='Error';};
      btn.appendChild(img);
      const badge=document.createElement('div');badge.className='idx';badge.textContent='#'+(idx+1);btn.appendChild(badge);
      btn.addEventListener('click',()=>openViewer(idx));
      frag.appendChild(btn);
    });
    grid.appendChild(frag);
    grid.setAttribute('aria-busy','false');

    const overlay=document.getElementById('overlay');
    const viewImg=document.getElementById('viewImg');
    const meta=document.getElementById('meta');
    let currentIdx=-1, currentUrl='';

    function openViewer(idx){
      if(idx<0||idx>=urls.length) return;
      currentIdx=idx;
      currentUrl=urls[idx];
      viewImg.src=currentUrl;
      meta.textContent='';
      overlay.classList.add('open');
      setTimeout(()=>{
        overlay.style.pointerEvents='auto';
      },300);
    }

    function closeViewer(){
      overlay.classList.remove('open');
      setTimeout(()=>{
        overlay.style.pointerEvents='none';
      },300);
    }

    document.getElementById('closeBtn').addEventListener('click',closeViewer);
    overlay.addEventListener('click',e=>{ if(e.target===overlay) closeViewer(); });
    document.getElementById('prevBtn').addEventListener('click',()=>openViewer(currentIdx-1));
    document.getElementById('nextBtn').addEventListener('click',()=>openViewer(currentIdx+1));

    window.addEventListener('keydown',e=>{
      if(!overlay.classList.contains('open')) return;
      if(e.key==='ArrowLeft') openViewer(currentIdx-1);
      else if(e.key==='ArrowRight') openViewer(currentIdx+1);
      else if(e.key==='Escape') closeViewer();
    });

  }catch(err){
    console.error(err);
    setStatus('Error loading photos: '+err.message,'error');
  }
})();
</script>
</body>
</html>
